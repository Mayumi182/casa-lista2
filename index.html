<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chá de Casa Nova - Lista de Presentes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Chá de Casa Nova</h1>
        <p>Escolha um presente e adicione seu nome:</p>

        <!-- Lista de presentes -->
        <ul id="present-list"></ul>

        <!-- Formulário para adicionar o nome -->
        <div class="form">
            <input type="text" id="name" placeholder="Digite seu nome" required>
            <button id="submit" onclick="submitChoice()">Confirmar escolha</button>
        </div>
    </div>

    <!-- Scripts do Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";

        // Configuração do Firebase (substitua com seus dados)
        const firebaseConfig = {
                apiKey: "AIzaSyDKXT7xVBuv-56IXKuUaah8-2aXp5MKY90",
                authDomain: "cha-casa-pandas-9913b.firebaseapp.com",
                databaseURL: "https://cha-casa-pandas-9913b-default-rtdb.firebaseio.com",
                projectId: "cha-casa-pandas-9913b",
                storageBucket: "cha-casa-pandas-9913b.firebasestorage.app",
                messagingSenderId: "878950006907",
                appId: "1:878950006907:web:62eb9256722a0bb77be2de"
        };

        // Inicializando o Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Referência para a lista de presentes no Firebase
        const presentsRef = ref(database, 'presents');

        // Função para exibir a lista de presentes
        function loadPresents() {
            onValue(presentsRef, (snapshot) => {
                const presents = snapshot.val();
                console.log("Dados carregados do Firebase:", presents);

                if (presents) {
                    const presentList = document.getElementById('present-list');
                    presentList.innerHTML = ''; // Limpar a lista antes de adicionar os itens

                    for (let id in presents) {
                        const present = presents[id];
                        const li = document.createElement('li');
                        li.classList.add('present-item');
                        li.innerHTML = `
                            <label>
                                <input type="checkbox" class="present-checkbox" data-id="${id}">
                                ${present.name}
                            </label>
                            <span id="chosen-by-${id}">${present.chosenBy ? `Escolhido por: ${present.chosenBy}` : ''}</span>
                        `;
                        presentList.appendChild(li);
                    }
                } else {
                    console.log("Nenhum presente encontrado.");
                }
            });
        }

        // Função para enviar a escolha do presente
        function submitChoice() {
            const name = document.getElementById('name').value;
            const checkedPresent = document.querySelector('.present-checkbox:checked');

            if (name && checkedPresent) {
                const presentId = checkedPresent.getAttribute('data-id');
                const chosenBySpan = document.getElementById(`chosen-by-${presentId}`);
                const presentRef = ref(database, 'presents/' + presentId);

                // Atualizando o presente com o nome do escolhido
                update(presentRef, { chosenBy: name });

                // Atualizando a interface
                chosenBySpan.innerText = `Escolhido por: ${name}`;
                document.getElementById('name').value = ''; // Limpar o campo de nome
            } else {
                alert('Por favor, escolha um presente e adicione seu nome.');
            }
        }

        // Carregar a lista de presentes ao carregar a página
        loadPresents();
    </script>
</body>
</html>
